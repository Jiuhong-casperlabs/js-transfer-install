import { decodeBase16 } from "casper-js-sdk";
import {
  parseSchemasFromBytes,
  parseEventNameAndData,
} from "@make-software/ces-js-parser";

const main = () => {
  // value stored under __events_schema",
  // const schemaHex =
  //   "02000000060000004d794f626a3102000000040000006e616d650a0400000073697a65130707060000004d794f626a3202000000040000006e616d650a05000000677261646507";
  const schemaHex =
    "0900000008000000417070726f76616c03000000050000006f776e65720b070000007370656e6465720b08000000746f6b656e5f69640a0e000000417070726f76616c466f72416c6c02000000050000006f776e65720b080000006f70657261746f720b0f000000417070726f76616c5265766f6b656402000000050000006f776e65720b08000000746f6b656e5f69640a040000004275726e03000000050000006f776e65720b08000000746f6b656e5f69640a060000006275726e65720b0f0000004d65746164617461557064617465640200000008000000746f6b656e5f69640a04000000646174610a090000004d6967726174696f6e00000000040000004d696e740300000009000000726563697069656e740b08000000746f6b656e5f69640a04000000646174610a080000005472616e7366657204000000050000006f776e65720b070000007370656e6465720d0b09000000726563697069656e740b08000000746f6b656e5f69640a0c0000005661726961626c657353657400000000";
  const schemas = parseSchemasFromBytes(decodeBase16(schemaHex));
  // const transformBytes =
  //   //   deploys including emit -  dictionary-xxxx
  //   "200000001c0000000c0000006576656e745f4d794f626a3205000000677261706502d5dd0e032000000093573167d6cd289024a08c16cb5e64c65f7247159e41e4ae046e7bdc0e32ec130100000031";
  const transformBytes =
    "d8000000d40000000a0000006576656e745f4d696e7400131fa68a31ccc4393a79e2fd05650e24443f2818a0fde5671ee1b834317b87900400000037363435990000007b226e616d65223a22427265657a792054776973746572202337363435222c2273796d626f6c223a22544d222c22746f6b656e5f757269223a2268747470733a2f2f617277656176652e6e65742f35304b5f5645505a47306d535561543356797250446266543741476c5479654e675a326d334b57333070302f6a736f6e2f427265657a795f547769737465725f373634352e6a736f6e227d0e03200000002167808e6b87e1873d397dd2be44057cc512724446db88c3758c863212b8fbb50400000037363435";
  const eventNameAndData = parseEventNameAndData(transformBytes, schemas);
  console.log(JSON.stringify(eventNameAndData));
};

// schemaHex is from __events_schema of : https://cspr.live/contract/be20e2dfdecc118e8863854bcd4ba66fd5fa26ccbfc0b81d53dadd81cfddabe7
// transformBytes is from deploy: bad8bbedb8474eb95eb39ba1e31e9b0ce38adfe284c4efa33f0cf46ef870c688 dictionary-d519130a4dcd09e8d4848bab846ffdb096be8803bc792f856ef09828f6dbc368

main();
